{"t": "config", "timeout_ms": 300000, "max_iterations": 10, "context_warn": 0.7, "context_compact": 0.85, "context_kill": 0.95}
{"t": "spec", "spec": "ralph-refactor.md"}
{"t": "task", "id": "t-v8t79p", "spec": "ralph-refactor.md", "name": "Extract cli.py module", "s": "p", "notes": "Extract the main CLI argparse setup and command dispatch logic from powerplant/ralph (lines 7409-7675) to ralph/cli.py. This includes setting up all subcommands and routing to command modules. Update __main__.py to import and call cli.main().", "accept": "ralph --help shows all commands and python -m ralph works", "priority": "high"}
{"t": "task", "id": "t-we7rah", "spec": "ralph-refactor.md", "name": "Create tui directory structure", "s": "p", "notes": "Create ralph/tui/ directory with __init__.py. Extract dashboard code from powerplant/ralph to tui/dashboard.py (Textual-based). Extract ANSI fallback dashboard to tui/fallback.py. Extract Ralph ASCII art (lines 297-463) to tui/art.py.", "accept": "tui/ directory exists with all three modules properly imported", "priority": "medium"}
{"t": "task", "id": "t-wkz4jq", "spec": "ralph-refactor.md", "name": "Extract remaining command modules", "s": "p", "notes": "Extract command functions from powerplant/ralph to ralph/commands/: status.py (cmd_status), config_cmd.py (cmd_config), watch.py (cmd_watch), stream.py (cmd_stream), plan.py (cmd_plan), construct.py (cmd_construct), query.py (cmd_query), task.py (task subcommands), issue.py (issue subcommands). Each module should have its command function.", "accept": "All command modules exist and can be imported from ralph.commands", "deps": ["t-v8t79p"], "priority": "high"}
{"t": "task", "id": "t-wp4c9c", "spec": "ralph-refactor.md", "name": "Create test directory structure", "s": "p", "notes": "Create ralph/tests/ directory with __init__.py, conftest.py (with common fixtures), unit/ subdirectory with __init__.py, and e2e/ subdirectory with __init__.py. This sets up the foundation for all tests.", "accept": "ralph/tests/ directory exists with proper structure and empty test files", "priority": "high"}
{"t": "task", "id": "t-wusosd", "spec": "ralph-refactor.md", "name": "Write unit tests for models.py", "s": "p", "notes": "Create ralph/tests/unit/test_models.py with tests for Task, Issue, Tombstone, and RalphPlanConfig dataclasses. Test creation, status transitions, serialization/deserialization, and all model methods. Use fixtures from conftest.py.", "accept": "pytest ralph/tests/unit/test_models.py passes", "deps": ["t-wp4c9c"], "priority": "high"}
{"t": "task", "id": "t-wzk7ds", "spec": "ralph-refactor.md", "name": "Write unit tests for state.py", "s": "p", "notes": "Create ralph/tests/unit/test_state.py with tests for RalphState class, load_state(), and save_state(). Test JSONL parsing, state merging, validation, and error handling. Mock file I/O operations.", "accept": "pytest ralph/tests/unit/test_state.py passes", "deps": ["t-wp4c9c"], "priority": "high"}
{"t": "task", "id": "t-w3ihll", "spec": "ralph-refactor.md", "name": "Write unit tests for config.py", "s": "p", "notes": "Create ralph/tests/unit/test_config.py with tests for GlobalConfig class. Test TOML loading, profile resolution, default values, validation, and environment variable handling. Mock file system and environment.", "accept": "pytest ralph/tests/unit/test_config.py passes", "deps": ["t-wp4c9c"], "priority": "high"}
{"t": "task", "id": "t-w9des9", "spec": "ralph-refactor.md", "name": "Write unit tests for context.py", "s": "p", "notes": "Create ralph/tests/unit/test_context.py with tests for Metrics, IterationKillInfo, ToolSummaries, and CompactedContext classes. Test context pressure thresholds (WARNING_PCT=70, COMPACT_PCT=85, KILL_PCT=95), metrics tracking, and compaction logic.", "accept": "pytest ralph/tests/unit/test_context.py passes", "deps": ["t-wp4c9c"], "priority": "high"}
{"t": "task", "id": "t-xfqbot", "spec": "ralph-refactor.md", "name": "Write remaining unit tests", "s": "p", "notes": "Create unit tests for: test_analysis.py (rejection pattern detection), test_prompts.py (prompt building/merging), test_git.py (git operations with mocked commands), test_utils.py (ID generation, ANSI formatting). Each test file in ralph/tests/unit/.", "accept": "pytest ralph/tests/unit/ runs all unit tests successfully", "deps": ["t-wp4c9c"], "priority": "low"}
{"t": "task", "id": "t-xkxnjl", "spec": "ralph-refactor.md", "name": "Write e2e tests for CLI", "s": "p", "notes": "Create ralph/tests/e2e/test_cli.py with tests for command parsing, help output, version display, and error handling. Test that all commands are accessible and basic argument parsing works.", "accept": "pytest ralph/tests/e2e/test_cli.py passes", "deps": ["t-wp4c9c", "t-v8t79p", "t-wkz4jq"], "priority": "high"}
{"t": "task", "id": "t-xqdmjr", "spec": "ralph-refactor.md", "name": "Write e2e tests for workflows", "s": "p", "notes": "Create e2e tests: test_init.py (ralph init in temp repo), test_task_workflow.py (add/done/accept/reject tasks), test_construct_flow.py (mock opencode, test stage transitions). Use temp directories and mock external calls.", "accept": "pytest ralph/tests/e2e/ passes all workflow tests", "deps": ["t-wp4c9c", "t-wkz4jq"], "priority": "high"}
{"t": "task", "id": "t-xwetfy", "spec": "ralph-refactor.md", "name": "Create AGENTS.md", "s": "p", "notes": "Create ralph/AGENTS.md with Ralph SDLC rules: development workflow (changes go through construct), testing requirements (new functions need tests), code style (type hints, docstrings, <50 lines, complexity <10), and self-improvement loop documentation.", "accept": "ralph/AGENTS.md exists with complete SDLC documentation", "priority": "low"}
{"t": "task", "id": "t-x1ne6h", "spec": "ralph-refactor.md", "name": "Create py.typed marker", "s": "p", "notes": "Create ralph/py.typed file (empty file) to mark the package as supporting type hints per PEP 561. This enables type checking for users of the ralph package.", "accept": "ralph/py.typed file exists", "priority": "medium"}
{"t": "task", "id": "t-x6goli", "spec": "ralph-refactor.md", "name": "Update bootstrap.sh for PYTHONPATH", "s": "p", "notes": "Add PYTHONPATH export to bootstrap.sh: create install_pythonpath_block() function similar to install_path_block(), add managed blocks to .profile and .zshrc that export PYTHONPATH with repo root. Keep existing PATH setup unchanged.", "accept": "After running bootstrap.sh, PYTHONPATH includes repo root", "priority": "high"}
{"t": "task", "id": "t-yjntln", "spec": "ralph-refactor.md", "name": "Verify complexity targets", "s": "p", "notes": "Install radon if not present. Run radon cc ralph/ --min C to ensure no function has complexity >= 11. Check that no function exceeds 50 lines and no module exceeds 500 lines. Fix any violations found.", "accept": "radon cc ralph/ --min C returns no results", "deps": ["t-v8t79p", "t-we7rah", "t-wkz4jq"], "priority": "medium"}
{"t": "task", "id": "t-yp7i3k", "spec": "ralph-refactor.md", "name": "Verify command parity", "s": "p", "notes": "Test all ralph commands work identically to before refactor: init, status, config, watch, plan, construct, query, task subcommands, issue subcommands, stream. Create a checklist and verify each command produces same output and behavior.", "accept": "All commands work exactly as before refactoring", "deps": ["t-y9w3he", "t-x6goli"], "priority": "medium"}
{"t": "task", "id": "t-yxbx29", "spec": "ralph-refactor.md", "name": "Run full test suite", "s": "p", "notes": "Run pytest ralph/tests/ with coverage report. Ensure all unit tests complete in <30s, e2e tests in <60s. Generate coverage report with --cov=ralph --cov-report=term-missing. Fix any failing tests.", "accept": "All tests pass with good coverage", "deps": ["t-wusosd", "t-wzk7ds", "t-w3ihll", "t-w9des9", "t-xfqbot", "t-xkxnjl", "t-xqdmjr"], "priority": "medium"}
{"t": "task", "id": "t-y9w3he", "spec": "ralph-refactor.md", "name": "Create ralph wrapper script", "s": "p", "notes": "Replace powerplant/ralph with a bash wrapper script containing: #!/usr/bin/env bash followed by exec python3 -m ralph \"$@\". Make it executable with chmod +x. This allows the refactored ralph package to be called via the existing PATH.", "accept": "powerplant/ralph is a bash script that calls python -m ralph", "deps": ["t-v8t79p", "t-wkz4jq"], "priority": "medium"}
{"t": "tombstone", "id": "i-jzfwf9", "reason": "Resolved: referenced tasks t-q46v22 and t-u54rxw no longer exist in plan; issue is stale"}
