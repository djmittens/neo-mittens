{"t": "config", "timeout_ms": 300000, "max_iterations": 10, "context_warn": 0.7, "context_compact": 0.85, "context_kill": 0.95}
{"t": "spec", "spec": "ralph-refactor.md"}
{"t": "task", "id": "t-2l9gq6", "spec": "ralph-refactor.md", "name": "Create app/ralph/tui/fallback.py with FallbackDashboard", "s": "p", "notes": "Create app/ralph/tui/fallback.py. Add DashboardState dataclass (from powerplant/ralph lines 4100-4122) with fields: stage, task, iteration, tokens, cost, status_message. Add FallbackDashboard class (from powerplant/ralph lines 4720-5024) with render() method that outputs ANSI-formatted dashboard. Add render_dashboard(state: DashboardState) -> list[str] function returning terminal lines.", "accept": "cd app && python -c \"from ralph.tui.fallback import FallbackDashboard, DashboardState; print(FallbackDashboard)\" shows class without errors", "deps": ["t-z2935f"], "priority": "low"}
{"t": "task", "id": "t-2l3ycp", "spec": "ralph-refactor.md", "name": "Create app/ralph/tui/dashboard.py with Textual TUI", "s": "d", "notes": "Create app/ralph/tui/dashboard.py. Add _create_textual_app() function (from powerplant/ralph lines 4134-4717) that creates Textual app with OutputLog, RalphArtWidget, StatusPanel widgets. Add RalphDashboard class extending textual.app.App. Import textual optionally with try/except ImportError fallback. Use art from ralph.tui.art.", "accept": "cd app && python -c \"from ralph.tui.dashboard import RalphDashboard; print(RalphDashboard)\" shows class without errors OR shows ImportError for textual", "deps": ["t-z2935f"], "done_at": "cc17474", "priority": "medium", "reject": "RalphDashboard class is not importable from the module - it's defined inside _create_textual_app() factory function rather than at module level. Need to export RalphDashboard at module level."}
{"t": "task", "id": "t-3dps3t", "spec": "ralph-refactor.md", "name": "Fix imports in app/ralph/commands/ modules", "s": "p", "notes": "Edit app/ralph/commands/construct.py lines 10-20 imports, app/ralph/commands/init.py lines 8-15 imports, app/ralph/commands/watch.py line 13 import, app/ralph/commands/task.py lines 5-10 imports, app/ralph/commands/issue.py lines 5-10 imports, app/ralph/commands/query.py lines 5-8 imports, app/ralph/commands/status.py lines 5-8 imports. Fix import paths to match new module structure: ralph.utils, ralph.models, ralph.state, ralph.config, ralph.stages.base, ralph.tui.fallback, ralph.opencode, ralph.prompts.", "accept": "cd app && python -c \"from ralph.commands import cmd_status, cmd_init, cmd_query\" exits code 0", "deps": ["t-22atpz", "t-0x5q32", "t-1r55xa", "t-2l9gq6"], "priority": "high"}
{"t": "task", "id": "t-3de908", "spec": "ralph-refactor.md", "name": "Rewrite app/ralph/commands/plan.py from stub", "s": "p", "notes": "Replace app/ralph/commands/plan.py stub entirely. Create cmd_plan(config: GlobalConfig, spec_file: str, args) function that: 1) loads state via state.load_state(), 2) reads spec file content, 3) loads PROMPT_plan.md via prompts.load_prompt(\"plan\"), 4) spawns opencode via opencode.spawn_opencode(), 5) parses JSON task output, 6) adds tasks to state.tasks, 7) saves state via state.save_state(), 8) clears issues for spec on PLAN_COMPLETE (lines 11-30 total).", "accept": "cd app && python -c \"from ralph.commands.plan import cmd_plan; import inspect; print(len(inspect.getsource(cmd_plan)) > 500)\" outputs True", "deps": ["t-22atpz", "t-0x5q32", "t-0xgnfu", "t-043ecb"], "priority": "medium"}
{"t": "task", "id": "t-3zpkrx", "spec": "ralph-refactor.md", "name": "Create app/ralph/tests/conftest.py with fixtures", "s": "p", "notes": "Create app/ralph/tests/conftest.py with pytest fixtures: tmp_ralph_dir (creates temp directory with ralph structure), mock_state (returns RalphState with sample tasks/issues), mock_config (returns GlobalConfig with test values), mock_opencode (patches spawn_opencode to return fake output). Use pytest.fixture decorator. Reference test patterns.", "accept": "cd app && python -c \"from ralph.tests.conftest import *\" exits code 0", "deps": ["t-zdqulm"], "priority": "medium"}
{"t": "task", "id": "t-309lme", "spec": "ralph-refactor.md", "name": "Create app/ralph/tests/unit/test_utils.py", "s": "p", "notes": "Create app/ralph/tests/unit/test_utils.py with tests: test_colors_ansi_codes, test_gen_id_format, test_gen_id_uniqueness. Verify Colors constants are strings, gen_id returns base36 format.", "accept": "cd app && pytest ralph/tests/unit/test_utils.py -v exits code 0", "deps": ["t-z2935f"], "priority": "low"}
{"t": "task", "id": "t-4qqxm0", "spec": "ralph-refactor.md", "name": "Create app/ralph/tests/e2e/test_init.py", "s": "p", "notes": "Create app/ralph/tests/e2e/test_init.py with tests: test_init_creates_structure, test_init_creates_prompts, test_init_idempotent. Use tmp_path to create temp directory, run ralph init, verify file creation.", "accept": "cd app && pytest ralph/tests/e2e/test_init.py -v exits code 0", "deps": ["t-3dps3t"], "priority": "high"}
{"t": "task", "id": "t-4qvn9s", "spec": "ralph-refactor.md", "name": "Create app/ralph/tests/e2e/test_task_workflow.py", "s": "p", "notes": "Create app/ralph/tests/e2e/test_task_workflow.py with tests: test_add_task, test_mark_task_done, test_accept_task, test_reject_task. Use tmp_path with initialized ralph structure, manipulate tasks via commands, verify state changes.", "accept": "cd app && pytest ralph/tests/e2e/test_task_workflow.py -v exits code 0", "deps": ["t-3dps3t"], "priority": "high"}
{"t": "task", "id": "t-4q3ev1", "spec": "ralph-refactor.md", "name": "Create app/ralph/tests/e2e/test_construct_flow.py", "s": "p", "notes": "Create app/ralph/tests/e2e/test_construct_flow.py with tests: test_construct_stage_transitions, test_construct_with_mock_opencode. Mock opencode.spawn_opencode to return fake output. Verify stage transitions INVESTIGATE->BUILD->VERIFY without real API calls.", "accept": "cd app && pytest ralph/tests/e2e/test_construct_flow.py -v exits code 0", "deps": ["t-3dps3t", "t-1r55xa"], "priority": "high"}
{"t": "task", "id": "t-46kgs3", "spec": "ralph-refactor.md", "name": "Create app/ralph/AGENTS.md with development rules", "s": "p", "notes": "Create app/ralph/AGENTS.md with content per spec lines 304-329. Include sections: Overview (ralph developed by ralph), Development Workflow (changes through construct mode), Testing Requirements (new functions need unit tests, new commands need e2e tests), Code Style (type hints, docstrings, max 50 lines, max complexity 10), Self-Improvement Loop (ralph creates specs for own improvement).", "accept": "cat app/ralph/AGENTS.md | grep -q \"Self-Improvement Loop\" && echo found shows found", "deps": ["t-zdqulm"], "priority": "low"}
{"t": "task", "id": "t-4719bj", "spec": "ralph-refactor.md", "name": "Create app/ralph/py.typed marker file", "s": "p", "notes": "Create empty app/ralph/py.typed file as PEP 561 marker indicating the package supports type checking. File should be empty or contain single comment line.", "accept": "test -f app/ralph/py.typed && echo exists shows exists", "deps": ["t-zdqulm"], "priority": "low"}
{"t": "task", "id": "t-475yar", "spec": "ralph-refactor.md", "name": "Add type hints to all public functions", "s": "p", "notes": "Review and add type hints to all public functions in app/ralph/*.py modules. Focus on: cli.py main() and command functions, config.py get_global_config(), state.py load_state/save_state, utils.py gen_id(), models.py to_dict/from_dict methods, prompts.py load_prompt/merge_prompts, git.py all functions, opencode.py all functions, analysis.py all functions.", "accept": "cd app && python -m mypy ralph --ignore-missing-imports 2>&1 | grep -v error || echo passed shows passed or minimal errors", "deps": ["t-3dps3t"], "priority": "medium"}
{"t": "task", "id": "t-471uxh", "spec": "ralph-refactor.md", "name": "Add docstrings to all public functions", "s": "p", "notes": "Add docstrings to all public functions in app/ralph/*.py modules. Each docstring should have brief description, Args section with parameter descriptions, Returns section with return type description. Focus on exported functions in __all__ lists.", "accept": "cd app && python -c \"from ralph.state import load_state; print(load_state.__doc__)\" shows docstring text", "deps": ["t-3dps3t"], "priority": "low"}
{"t": "task", "id": "t-5ox1vj", "spec": "ralph-refactor.md", "name": "Run complexity checks with radon", "s": "p", "notes": "Run radon cc app/ralph/ -a -s to measure cyclomatic complexity. Verify no function has complexity >= C (10). Run radon cc app/ralph/ --min C to find violations. Refactor any functions exceeding threshold by extracting helper functions or simplifying logic.", "accept": "radon cc app/ralph/ --min C 2>&1 | wc -l shows 0 or only header lines (no violations)", "deps": ["t-3dps3t", "t-1r55xa", "t-2l9gq6"], "priority": "medium"}
{"t": "task", "id": "t-5olkzx", "spec": "ralph-refactor.md", "name": "Verify python -m ralph command parity", "s": "p", "notes": "Test all commands work identically between python -m ralph and powerplant/ralph. Run python -m ralph --help, python -m ralph status, python -m ralph query against same ralph/ directory. Compare output format and exit codes.", "accept": "cd app && python -m ralph --version && python -m ralph query 2>&1 | grep -q stage && echo parity shows parity", "deps": ["t-3dps3t"], "priority": "low"}
{"t": "task", "id": "t-546d5b", "spec": "ralph-refactor.md", "name": "Run unit test suite timing check", "s": "p", "notes": "Execute pytest app/ralph/tests/unit/ -q to run all unit tests. This is a verification step, not a code change. Unit tests should already be created by previous tasks. Total time must be under 30 seconds per spec.", "accept": "timeout 30 pytest app/ralph/tests/unit/ -q && echo passed shows passed", "deps": ["t-3zxzp1", "t-3zid18", "t-30xvj7", "t-309lme", "t-4cehzx", "t-4d6pu8", "t-4duoil", "t-4dka52"], "priority": "medium"}
{"t": "task", "id": "t-55ab9c", "spec": "ralph-refactor.md", "name": "Run e2e test suite timing check", "s": "p", "notes": "Execute pytest app/ralph/tests/e2e/ -q to run all e2e tests. This is a verification step, not a code change. E2E tests should already be created by previous tasks and should mock opencode. Total time must be under 60 seconds per spec.", "accept": "timeout 60 pytest app/ralph/tests/e2e/ -q && echo passed shows passed", "deps": ["t-4p3ifp", "t-4qqxm0", "t-4qvn9s", "t-4q3ev1"], "priority": "medium"}
{"t": "task", "id": "t-6m1zgb", "spec": "ralph-refactor.md", "name": "Create app/ralph/commands/validate.py", "s": "p", "notes": "Create app/ralph/commands/validate.py with cmd_validate(config: GlobalConfig, args) function. Validate task fields: check all tasks have required fields (id, name, notes, accept), verify notes are detailed (min 50 chars), verify accept is measurable (min 15 chars), check deps reference existing task IDs. Return exit code 0 if valid, 1 with errors listed.", "accept": "cd app && python -c \"from ralph.commands.validate import cmd_validate; print(callable(cmd_validate))\" outputs True", "deps": ["t-22atpz", "t-0x5q32"], "priority": "medium"}
{"t": "task", "id": "t-6mhbur", "spec": "ralph-refactor.md", "name": "Create app/ralph/commands/compact.py", "s": "p", "notes": "Create app/ralph/commands/compact.py with cmd_compact(config: GlobalConfig, args) function. Compact plan.jsonl by removing completed tasks older than threshold, archiving accepted tombstones. Load state via state.load_state(), filter tasks/tombstones, save via state.save_state(). Report items removed.", "accept": "cd app && python -c \"from ralph.commands.compact import cmd_compact; print(callable(cmd_compact))\" outputs True", "deps": ["t-22atpz", "t-0x5q32"], "priority": "medium"}
{"t": "task", "id": "t-6nb35k", "spec": "ralph-refactor.md", "name": "Add validate and compact to cli.py subcommands", "s": "p", "notes": "Edit app/ralph/cli.py to add subparsers for validate and compact commands. Import cmd_validate from ralph.commands.validate, cmd_compact from ralph.commands.compact. Add to command dispatch in main() function alongside other subcommands.", "accept": "cd app && python -m ralph validate --help 2>&1 | grep -q validate && echo found shows found", "deps": ["t-zmy8ss"], "priority": "medium"}
{"t": "task", "id": "t-b87my5", "spec": "ralph-refactor.md", "name": "Add line count checks to complexity verification", "s": "p", "notes": "Edit task t-5ox1vj verification or create separate check: run wc -l on all .py files in app/ralph/ to verify no function exceeds 50 lines and no module exceeds 500 lines. Use tools like: find app/ralph -name \"*.py\" -exec wc -l {} \\; to count lines per module. For function line counts, use radon raw or custom script to identify functions over 50 lines.", "accept": "find app/ralph -name \"*.py\" ! -path \"*/tests/*\" -exec wc -l {} + shows all modules under 500 lines AND no function body exceeds 50 lines", "deps": ["t-5ox1vj"], "priority": "medium"}
{"t": "task", "id": "t-cfb2wf", "spec": "ralph-refactor.md", "name": "Create backwards compatibility e2e tests", "s": "p", "notes": "Create app/ralph/tests/e2e/test_backwards_compat.py with tests: test_reads_existing_plan_jsonl (use sample plan.jsonl from ralph/ directory), test_loads_existing_prompts (verify PROMPT_*.md files are loadable), test_loads_global_config (verify ~/.config/ralph/config.toml loading). Use tmp_path and copy existing files to test directory.", "accept": "cd app && pytest ralph/tests/e2e/test_backwards_compat.py -v exits code 0", "deps": ["t-3dps3t"], "priority": "high"}
{"t": "task", "id": "t-uq3qjc", "spec": "ralph-refactor.md", "name": "Verify shell completions still work with powerplant/ralph", "s": "p", "notes": "Run ralph command with shell completions to verify they still work. Test bash/zsh completion for ralph commands. Since powerplant/ralph is not modified and completions are tied to it, this should pass. Run: source the completion script and verify ralph <tab> shows subcommands. Check that .bashrc/.zshrc still has completion setup from bootstrap.", "accept": "ralph <tab><tab> in interactive shell shows subcommands list OR completion script exists in shell config", "priority": "low"}
{"t": "task", "id": "t-uvpc47", "spec": "ralph-refactor.md", "name": "Verify ralph --version continues to work", "s": "p", "notes": "Run powerplant/ralph --version to verify the original monolithic script still works correctly. This confirms the guardrail is respected and production ralph is unaffected. Command: ralph --version should output version from powerplant/ralph. Also verify ralph --help works.", "accept": "ralph --version outputs version string and ralph --help shows usage without errors", "deps": ["t-b2vcmb"], "priority": "medium"}
{"t": "task", "id": "t-u3lbf3", "spec": "ralph-refactor.md", "name": "Verify python -m ralph construct runs on ralph/specs/", "s": "p", "notes": "Create integration test that verifies python -m ralph construct can actually be invoked on specs in ralph/specs/ directory. This is beyond mocked tests - verify the command can at least parse a spec file and initialize stage machine. Use --dry-run flag if available, or verify first stage begins. Test with an existing spec file like ralph/specs/ralph-refactor.md.", "accept": "cd app && python -m ralph construct ralph/specs/ralph-refactor.md --help OR python -m ralph construct shows usage/starts without import errors", "deps": ["t-3dps3t", "t-1r55xa"], "priority": "medium"}
{"t": "task", "id": "t-vao645", "spec": "ralph-refactor.md", "name": "Verify local development mode - changes take effect immediately", "s": "p", "notes": "Create test to verify editing app/ralph/cli.py and running python -m ralph reflects changes immediately. Steps: 1) Read current cli.py, 2) Add temporary marker to --help output, 3) Run python -m ralph --help, verify marker appears, 4) Remove marker, verify it disappears. This confirms no pip install or build step required.", "accept": "Modify app/ralph/cli.py, run python -m ralph --help, see change reflected immediately, revert change", "deps": ["t-3dps3t"], "priority": "low"}
{"t": "task", "id": "t-le08sd", "spec": "ralph-refactor.md", "name": "Add comprehensive error handling and validation to decompose.py", "s": "p", "notes": "In /Users/ngridinskiy/src/neo-mittens/app/ralph/stages/decompose.py: (1) Wrap lines 46-62 in try/except to catch process failures, UnicodeDecodeError, KeyError, and TypeError; (2) Add validation before Task creation: check subtasks is a list, each subtask has required name field, generate UUID if id missing; (3) Add type checks using isinstance() for subtask dict fields; (4) Add logging module import and log warnings when parsing fails or fields are missing; (5) Consider adding a helper function validate_subtask(data: dict) -> Optional[Task] that returns None for invalid entries with logged warnings.", "accept": "pytest app/ralph/stages/test_decompose.py passes AND grep -c except app/ralph/stages/decompose.py returns at least 2", "priority": "medium", "created_from": "i-hxbbee"}
{"t": "task", "id": "t-ujq2yx", "spec": "ralph-refactor.md", "name": "Fix type hints and metrics extraction in build.py", "s": "p", "notes": "Modify app/ralph/stages/build.py: First remove unreachable dead code from lines 133-222 after the return statement on line 131. Then fix lines 123-124 to use proper attribute access on Metrics dataclass instead of dict-style .get() method - change to metrics.tokens_used and metrics.total_cost. Wrap metrics extraction at line 76 in try/except with fallback to default Metrics() on failure. Add explicit type annotation metrics: Metrics.", "accept": "python3 -c \"import ast; ast.parse(open(app/ralph/stages/build.py).read())\" succeeds AND grep -c metrics.get app/ralph/stages/build.py returns 0", "priority": "medium", "created_from": "i-qzo1jk"}
{"t": "accept", "id": "t-zdqulm", "done_at": "7db4e96", "reason": "ls -la app/ralph/ shows all directories and python -c \"import sys; sys.path.insert(0, app); from ralph import __version__; print(__version__)\" outputs 0.1.0", "name": "Create app/ralph/ package directory structure", "timestamp": "2026-01-21T11:18:11-08:00", "changed_files": [".opencode/skills/ralph-spec/SKILL.md", "powerplant/ralph", "ralph/PROMPT_plan.md"], "notes": "Create the directory structure: app/ralph/, app/ralph/stages/, app/ralph/commands/, app/ralph/tui/, app/ralph/tests/, app/ralph/tests/unit/, app/ralph/tests/e2e/. Create __init__.py in each package directory. app/ralph/__init__.py should define __version__ = \"0.1.0\"."}
{"t": "accept", "id": "t-zdgqe0", "done_at": "560f4aa", "reason": "cd app && python -m ralph --help exits with code 0 and shows usage information", "name": "Create app/ralph/__main__.py entry point", "timestamp": "2026-01-21T11:20:37-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/__main__.py that serves as entry point for python -m ralph. Import and call main() from cli module. Pattern: if __name__ == \"__main__\": from ralph.cli import main; sys.exit(main()). Initially can just print version and help stub."}
{"t": "accept", "id": "t-zmy8ss", "done_at": "e50aecc", "reason": "cd app && python -m ralph status 2>&1 | grep -q \"status\" && echo found shows \"found\"", "name": "Create app/ralph/cli.py with argparse setup", "timestamp": "2026-01-21T11:22:21-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/cli.py with argparse setup for all commands. Define main() function that parses args and dispatches to command functions. Subcommands: init, status, config, watch, stream, plan, construct, query, task, issue, validate, compact. Each subcommand should initially return stub message. Include --version and --help flags. Pattern from powerplant/ralph."}
{"t": "accept", "id": "t-z2935f", "done_at": "8f82fc2", "reason": "cd app && python -c \"from ralph.utils import Colors, gen_id; print(Colors.GREEN + gen_id() + Colors.RESET)\" outputs colored ID string", "name": "Create app/ralph/utils.py with Colors and utilities", "timestamp": "2026-01-21T11:25:58-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Extract from powerplant/ralph lines 218-295 (Colors class with ANSI codes), id generation (gen_id function ~line 477), and misc utilities. Colors should have: RESET, BOLD, DIM, RED, GREEN, YELLOW, BLUE, CYAN, WHITE, GRAY, HAIR, SKIN, SHIRT_BLUE, BG_* variants. Include gen_id() for task/issue ID generation using base36."}
{"t": "accept", "id": "t-z2qikh", "done_at": "3504174", "reason": "cd app && python -c \"from ralph.models import Task, Issue, Tombstone, RalphPlanConfig; t = Task(id=t-test, name=test, spec=spec.md); print(t.to_dict())\" outputs dict with task fields", "name": "Create app/ralph/models.py with dataclasses", "timestamp": "2026-01-21T11:28:13-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create dataclasses: Task (id, name, spec, notes, accept, deps, status, priority, parent, created_from, supersedes), Issue (id, spec, description, source, created), Tombstone (id, status accepted/rejected, task snapshot, reason), RalphPlanConfig (stage, current_task, etc). Include to_dict() and from_dict() methods for JSONL serialization. Reference powerplant/ralph dataclass definitions."}
{"t": "accept", "id": "t-z3mqfe", "done_at": "f7e4c6b", "reason": "cd app && python -c \"from ralph.config import GlobalConfig, get_global_config; c = get_global_config(); print(c.model, c.context_window)\" outputs model and context window values", "name": "Create app/ralph/config.py with GlobalConfig", "timestamp": "2026-01-21T11:32:01-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create GlobalConfig dataclass with fields: model, context_window, timeout_ms, max_iterations, profile. Include get_global_config() function that loads from ~/.config/ralph/config.toml using tomllib (Python 3.11+). Support RALPH_PROFILE env var for profile selection. Provide sensible defaults if config file missing."}
{"t": "accept", "id": "t-0gku1c", "done_at": "a50ee2c", "reason": "cd app && python -c \"from ralph.git import sync_with_remote, push_with_retry, has_uncommitted_plan, get_current_commit; print(get_current_commit())\" outputs git commit hash", "name": "Create app/ralph/git.py with git operations", "timestamp": "2026-01-21T12:30:34-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create functions: sync_with_remote() - fetch and merge remote changes, push_with_retry(retries=3) - push with retry logic, has_uncommitted_plan() - check if plan.jsonl has uncommitted changes, get_current_commit() - get HEAD hash. Use subprocess to run git commands. Reference powerplant/ralph git sync logic."}
{"t": "accept", "id": "t-0gie7f", "done_at": "75ec7b1", "reason": "cd app && python -c \"from ralph.context import Metrics, WARNING_PCT, COMPACT_PCT, KILL_PCT; print(WARNING_PCT, COMPACT_PCT, KILL_PCT)\" outputs 70 85 95", "name": "Create app/ralph/context.py with Metrics", "timestamp": "2026-01-21T12:34:56-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create dataclasses: Metrics (tokens_used, cost, iterations, duration). Create IterationKillInfo, ToolSummaries, CompactedContext for context management. Define threshold constants: WARNING_PCT=70, COMPACT_PCT=85, KILL_PCT=95. Include context_pressure(metrics, config) function to calculate percentage. Reference powerplant/ralph context handling."}
{"t": "accept", "id": "t-0x5q32", "done_at": "30a208e", "reason": "cd app && python -c \"from ralph.state import RalphState, load_state, save_state; print(RalphState)\" shows class without import errors", "name": "Create app/ralph/state.py with RalphState", "timestamp": "2026-01-21T12:38:05-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/state.py with RalphState class that holds: tasks (list of Task), issues (list of Issue), tombstones (dict with accepted/rejected lists), config (RalphPlanConfig). Add load_state(path: Path) -> RalphState function that reads plan.jsonl line by line, parses JSON, creates Task/Issue/Tombstone/Config objects. Add save_state(state: RalphState, path: Path) function that writes each object as JSON line. Extract parsing logic from powerplant/ralph load_plan function."}
{"t": "accept", "id": "t-0xgnfu", "done_at": "3fe7045", "reason": "cd app && python -c \"from ralph.prompts import load_prompt, build_prompt_with_rules, merge_prompts; print(callable(load_prompt))\" outputs True", "name": "Create app/ralph/prompts.py with prompt loading", "timestamp": "2026-01-21T12:41:06-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/prompts.py with: load_prompt(stage: str) -> str function that reads PROMPT_{stage}.md from ralph/ directory. Add build_prompt_with_rules(prompt: str, rules_path: Path) -> str that combines prompt with AGENTS.md rules. Add merge_prompts(old: str, new: str, strategy: str) -> str for prompt update handling during init. Reference powerplant/ralph prompt loading patterns."}
{"t": "accept", "id": "t-0xsmlr", "done_at": "7d1e095", "reason": "cd app && python -c \"from ralph.analysis import analyze_rejection_patterns, suggest_issues; print(callable(analyze_rejection_patterns))\" outputs True", "name": "Create app/ralph/analysis.py with rejection analysis", "timestamp": "2026-01-21T12:44:01-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/analysis.py with: analyze_rejection_patterns(tombstones: list[Tombstone]) -> dict that detects recurring failure patterns in rejected tasks. Add suggest_issues(patterns: dict) -> list[Issue] that generates issue suggestions from detected patterns. Reference powerplant/ralph rejection analysis if present."}
{"t": "accept", "id": "t-043ecb", "done_at": "3e631b1", "reason": "cd app && python -c \"from ralph.opencode import spawn_opencode, parse_json_stream, extract_metrics; print(callable(spawn_opencode))\" outputs True", "name": "Create app/ralph/opencode.py with opencode integration", "timestamp": "2026-01-21T12:46:22-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/opencode.py. Add spawn_opencode(prompt: str, cwd: Path, timeout: int) -> subprocess.Popen function that spawns opencode process; set XDG_STATE_HOME env var, use subprocess.Popen with stdout=PIPE. Add parse_json_stream(output: str) -> Iterator[dict] generator that yields parsed JSON objects from newline-delimited output. Add extract_metrics(output: str) -> Metrics that parses cost/token fields. Pattern from powerplant/ralph _spawn_opencode function around line 3800."}
{"t": "accept", "id": "t-1r55xa", "done_at": "6efcf83", "reason": "cd app && python -c \"from ralph.stages.base import Stage, StageOutcome, StageResult, ConstructStateMachine; print(Stage.BUILD)\" outputs Stage.BUILD", "name": "Create app/ralph/stages/base.py with Stage enum and state machine", "timestamp": "2026-01-21T12:48:22-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/stages/base.py with: Stage enum (INVESTIGATE, BUILD, VERIFY, DECOMPOSE, COMPLETE), StageOutcome enum (SUCCESS, FAILURE, SKIP), StageResult dataclass (stage, outcome, message, metrics). Add ConstructStateMachine class with transition logic: INVESTIGATE->BUILD->VERIFY->COMPLETE or VERIFY->DECOMPOSE->INVESTIGATE. Reference powerplant/ralph ConstructStateMachine class around line 3500."}
{"t": "accept", "id": "t-22atpz", "done_at": "02bfa16", "reason": "ls app/ralph/commands/*.py | wc -l shows at least 11 files", "name": "Move ralph/commands/ to app/ralph/commands/", "timestamp": "2026-01-21T12:51:03-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Copy all files from ralph/commands/ to app/ralph/commands/: __init__.py, init.py, status.py, config_cmd.py, watch.py, stream.py, plan.py, construct.py, query.py, task.py, issue.py. Keep ralph/commands/ intact as it belongs to production ralph. Files need import path fixes in next task."}
{"t": "accept", "id": "t-3zxzp1", "done_at": "991a56b", "reason": "cd app && pytest ralph/tests/unit/test_models.py -v exits code 0", "name": "Create app/ralph/tests/unit/test_models.py", "timestamp": "2026-01-21T12:52:25-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/unit/test_models.py with tests: test_task_creation, test_task_to_dict, test_task_from_dict, test_issue_creation, test_tombstone_creation, test_ralph_plan_config. Each test creates model instance, verifies fields, tests serialization roundtrip. Use pytest assertions."}
{"t": "accept", "id": "t-3zid18", "done_at": "e9cbade", "reason": "cd app && pytest ralph/tests/unit/test_state.py -v exits code 0", "name": "Create app/ralph/tests/unit/test_state.py", "timestamp": "2026-01-21T12:54:28-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/unit/test_state.py with tests: test_load_state_empty, test_load_state_with_tasks, test_save_state, test_state_roundtrip. Use tmp_path fixture to create temp plan.jsonl files. Mock file operations where needed."}
{"t": "accept", "id": "t-30xvj7", "done_at": "2c38af4", "reason": "cd app && pytest ralph/tests/unit/test_config.py -v exits code 0", "name": "Create app/ralph/tests/unit/test_config.py", "timestamp": "2026-01-21T12:56:37-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/unit/test_config.py with tests: test_global_config_defaults, test_load_config_from_toml, test_profile_selection, test_missing_config_file. Use tmp_path to create temp config files. Mock os.environ for RALPH_PROFILE."}
{"t": "accept", "id": "t-4cehzx", "done_at": "c2112be", "reason": "cd app && pytest ralph/tests/unit/test_context.py -v exits code 0", "name": "Create app/ralph/tests/unit/test_context.py", "timestamp": "2026-01-21T12:58:49-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/unit/test_context.py with tests: test_metrics_creation, test_threshold_constants, test_context_pressure_calculation. Verify Metrics dataclass fields, verify WARNING_PCT=70, COMPACT_PCT=85, KILL_PCT=95."}
{"t": "accept", "id": "t-4d6pu8", "done_at": "263521c", "reason": "cd app && pytest ralph/tests/unit/test_git.py -v exits code 0", "name": "Create app/ralph/tests/unit/test_git.py", "timestamp": "2026-01-21T13:01:20-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/unit/test_git.py with tests: test_get_current_commit, test_has_uncommitted_plan, test_sync_with_remote, test_push_with_retry. Mock subprocess.run calls to avoid actual git operations. Use unittest.mock.patch."}
{"t": "accept", "id": "t-4duoil", "done_at": "8995ea2", "reason": "cd app && pytest ralph/tests/unit/test_prompts.py -v exits code 0", "name": "Create app/ralph/tests/unit/test_prompts.py", "timestamp": "2026-01-21T13:03:19-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/unit/test_prompts.py with tests: test_load_prompt, test_build_prompt_with_rules, test_merge_prompts. Use tmp_path to create temp PROMPT_*.md files for loading tests."}
{"t": "accept", "id": "t-4dka52", "done_at": "9486e45", "reason": "cd app && pytest ralph/tests/unit/test_analysis.py -v exits code 0", "name": "Create app/ralph/tests/unit/test_analysis.py", "timestamp": "2026-01-21T13:05:16-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/unit/test_analysis.py with tests: test_analyze_rejection_patterns_empty, test_analyze_rejection_patterns_with_data, test_suggest_issues. Create sample Tombstone objects with patterns for analysis."}
{"t": "accept", "id": "t-4p3ifp", "done_at": "04f5549", "reason": "cd app && pytest ralph/tests/e2e/test_cli.py -v exits code 0", "name": "Create app/ralph/tests/e2e/test_cli.py", "timestamp": "2026-01-21T13:07:52-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tests/e2e/test_cli.py with tests: test_help_output, test_version_output, test_subcommand_parsing. Use subprocess to run \"python -m ralph --help\" etc. Verify exit codes and output contains expected strings."}
{"t": "accept", "id": "t-b2vcmb", "done_at": "6be07e3", "reason": "git diff --name-only powerplant/ralph shows no output (file unchanged from last commit before this spec)", "name": "Verify powerplant/ralph not modified", "timestamp": "2026-01-21T13:09:24-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Run git diff --name-only on powerplant/ralph to confirm the original monolithic script has not been modified. This is a critical guardrail check. Compare current file hash against known baseline or check git status shows no modifications to powerplant/ralph."}
{"t": "accept", "id": "t-zmxr4c", "done_at": "9c26021", "reason": "grep -q \"app\" bootstrap.sh && echo found shows \"found\" and PYTHONPATH contains app directory after sourcing", "name": "Update bootstrap.sh PYTHONPATH for app/ directory", "timestamp": "2026-01-21T13:13:51-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Modify bootstrap.sh install_pythonpath_block calls (around lines 338-340) to also add $SCRIPT_DIR/app to PYTHONPATH. Keep existing repo root PYTHONPATH. Add: install_pythonpath_block \"$HOME/.profile\" \"$SCRIPT_DIR/app\" and install_pythonpath_block \"$HOME/.zshrc\" \"$SCRIPT_DIR/app\" after existing PYTHONPATH setup."}
{"t": "accept", "id": "t-1sw9pg", "done_at": "8a1b7f4", "reason": "cd app && python -c \"from ralph.stages.investigate import run; print(callable(run))\" outputs True", "name": "Create app/ralph/stages/investigate.py with INVESTIGATE logic", "timestamp": "2026-01-21T13:17:55-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/stages/investigate.py with run(state: RalphState, config: GlobalConfig) -> StageResult function. INVESTIGATE stage reads spec file, analyzes codebase context, returns StageResult. Should load PROMPT_investigate.md and spawn opencode with it. Reference powerplant/ralph _run_investigate function."}
{"t": "accept", "id": "t-1s5jnt", "done_at": "08878a7", "reason": "cd app && python -c \"from ralph.stages.verify import run; print(callable(run))\" outputs True", "name": "Create app/ralph/stages/verify.py with VERIFY logic", "timestamp": "2026-01-21T13:25:37-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/stages/verify.py with run(state: RalphState, config: GlobalConfig) -> StageResult function. VERIFY stage runs acceptance criteria tests, spawns opencode with PROMPT_verify.md. Returns SUCCESS if tests pass, FAILURE if task should be rejected. Reference powerplant/ralph _run_verify function."}
{"t": "accept", "id": "t-1s7fae", "done_at": "e6ffc2f", "reason": "cd app && python -c \"from ralph.stages.decompose import run; print(callable(run))\" outputs True", "name": "Create app/ralph/stages/decompose.py with DECOMPOSE logic", "timestamp": "2026-01-21T13:30:12-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/stages/decompose.py with run(state: RalphState, config: GlobalConfig) -> StageResult function. DECOMPOSE stage breaks down failed tasks into subtasks, spawns opencode with PROMPT_decompose.md. Returns SUCCESS with new subtasks created. Reference powerplant/ralph _run_decompose function."}
{"t": "accept", "id": "t-1zewba", "done_at": "9c8e85b", "reason": "cd app && python -c \"from ralph.stages.build import run; print(callable(run))\" outputs True", "name": "Create app/ralph/stages/build.py with BUILD logic", "timestamp": "2026-01-21T13:34:34-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/stages/build.py. Add run(state: RalphState, config: GlobalConfig) -> StageResult function. Load PROMPT_build.md via prompts.load_prompt(\"build\"). Get current task from state.config.current_task. Build prompt with task context (name, notes, accept criteria). Spawn opencode via opencode.spawn_opencode(). Parse output and return StageResult(Stage.BUILD, StageOutcome.SUCCESS/FAILURE). Pattern from powerplant/ralph _run_build around line 3600."}
{"t": "reject", "id": "t-2kqkqj", "done_at": "7e7fa9d", "reason": "get_ralph_art() returns a list of 11 art lines, not >100. len(get_ralph_art())=11. Acceptance criteria expects True but outputs False.", "name": "Create app/ralph/tui/art.py with ASCII art", "timestamp": "2026-01-21T13:39:45-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tui/art.py. Extract RALPH_ART constant from powerplant/ralph lines 297-463 containing Ralph Wiggum ASCII art in braille/blocks/minimal styles. Add _colorize_art(art: str, colors: Colors) -> str function. Add get_ralph_art(style: str = \"braille\") -> str function that returns colorized art. Use Colors from ralph.utils."}
{"t": "accept", "id": "t-2kqkqj", "done_at": "b563e35", "reason": "cd app && python -c \"from ralph.tui.art import get_ralph_art, RALPH_ART; print(len(get_ralph_art()) > 100)\" outputs True", "name": "Create app/ralph/tui/art.py with ASCII art", "timestamp": "2026-01-21T13:43:49-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tui/art.py. Extract RALPH_ART constant from powerplant/ralph lines 297-463 containing Ralph Wiggum ASCII art in braille/blocks/minimal styles. Add _colorize_art(art: str, colors: Colors) -> str function. Add get_ralph_art(style: str = \"braille\") -> str function that returns colorized art. Use Colors from ralph.utils."}
{"t": "reject", "id": "t-2l3ycp", "done_at": "7d8f1c3", "reason": "RalphDashboard class is not importable from the module - it's defined inside _create_textual_app() factory function rather than at module level. Need to export RalphDashboard at module level.", "name": "Create app/ralph/tui/dashboard.py with Textual TUI", "timestamp": "2026-01-21T13:45:50-08:00", "changed_files": ["ralph/plan.jsonl"], "notes": "Create app/ralph/tui/dashboard.py. Add _create_textual_app() function (from powerplant/ralph lines 4134-4717) that creates Textual app with OutputLog, RalphArtWidget, StatusPanel widgets. Add RalphDashboard class extending textual.app.App. Import textual optionally with try/except ImportError fallback. Use art from ralph.tui.art."}
