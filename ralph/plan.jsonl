{"t": "config", "timeout_ms": 300000, "max_iterations": 10, "context_warn": 0.7, "context_compact": 0.85, "context_kill": 0.95}
{"t": "spec", "spec": "ralph-refactor.md"}
{"t": "task", "id": "t-ssbh87", "spec": "ralph-refactor.md", "name": "Extract commands/status.py", "s": "p", "notes": "Extract cmd_status function for ralph status command. Displays current plan state, pending tasks, issues.", "accept": "from ralph.commands.status import cmd_status works", "deps": ["t-skfdoh", "t-q46v22"]}
{"t": "task", "id": "t-sxh4ms", "spec": "ralph-refactor.md", "name": "Extract commands/config_cmd.py", "s": "p", "notes": "Extract cmd_config function for ralph config command. Named config_cmd.py to avoid collision with config.py module.", "accept": "from ralph.commands.config_cmd import cmd_config works", "deps": ["t-skfdoh", "t-qzr2sy"]}
{"t": "task", "id": "t-s0kjjj", "spec": "ralph-refactor.md", "name": "Extract commands/query.py", "s": "p", "notes": "Extract cmd_query function for ralph query command. Returns JSON state for spec/tasks/issues.", "accept": "from ralph.commands.query import cmd_query works", "deps": ["t-skfdoh", "t-q46v22"]}
{"t": "task", "id": "t-s5st5x", "spec": "ralph-refactor.md", "name": "Extract commands/task.py", "s": "p", "notes": "Extract task subcommands: add, done, accept, reject, delete, prioritize. Each modifies plan.jsonl state.", "accept": "from ralph.commands.task import cmd_task_add, cmd_task_done works", "deps": ["t-skfdoh", "t-q46v22", "t-q9a9n4"]}
{"t": "task", "id": "t-s9jxdv", "spec": "ralph-refactor.md", "name": "Extract commands/issue.py", "s": "p", "notes": "Extract issue subcommands: add, done, done-all, done-ids. Manages issues in plan.jsonl.", "accept": "from ralph.commands.issue import cmd_issue_add, cmd_issue_done works", "deps": ["t-skfdoh", "t-q46v22", "t-q9a9n4"]}
{"t": "task", "id": "t-tdguho", "spec": "ralph-refactor.md", "name": "Extract commands/plan.py", "s": "p", "notes": "Extract cmd_plan function for ralph plan command. Creates plan from spec file, adds tasks.", "accept": "from ralph.commands.plan import cmd_plan works", "deps": ["t-skfdoh", "t-q46v22", "t-rs0vlm"]}
{"t": "task", "id": "t-tjfypt", "spec": "ralph-refactor.md", "name": "Extract commands/construct.py", "s": "p", "notes": "Extract cmd_construct function for ralph construct command. Runs the construct loop using stages. Depends on stages package.", "accept": "from ralph.commands.construct import cmd_construct works", "deps": ["t-skfdoh", "t-r5dzxs", "t-r9yj8k", "t-sczvjn", "t-sgsuyp", "t-rs0vlm", "t-reayd6"]}
{"t": "task", "id": "t-tm55mo", "spec": "ralph-refactor.md", "name": "Extract commands/watch.py", "s": "p", "notes": "Extract cmd_watch function for ralph watch command. Monitors plan state and displays updates.", "accept": "from ralph.commands.watch import cmd_watch works", "deps": ["t-skfdoh", "t-q46v22"]}
{"t": "task", "id": "t-tq2jek", "spec": "ralph-refactor.md", "name": "Extract commands/stream.py", "s": "p", "notes": "Extract cmd_stream function for ralph stream command. Streams construct output in real-time.", "accept": "from ralph.commands.stream import cmd_stream works", "deps": ["t-skfdoh", "t-q46v22", "t-rs0vlm"]}
{"t": "task", "id": "t-txl244", "spec": "ralph-refactor.md", "name": "Create cli.py argparse and dispatch", "s": "p", "notes": "Create ralph/cli.py with argparse setup, subcommand routing to commands/ modules, global exception handling, exit code management.", "accept": "python -m ralph --help shows all commands; dispatches correctly to command modules", "deps": ["t-spqfwr", "t-ssbh87", "t-sxh4ms", "t-s0kjjj", "t-s5st5x", "t-s9jxdv", "t-tdguho", "t-tjfypt", "t-tm55mo", "t-tq2jek"]}
{"t": "task", "id": "t-t06dzv", "spec": "ralph-refactor.md", "name": "Create tui/__init__.py package", "s": "p", "notes": "Create TUI package with __init__.py.", "accept": "from ralph.tui import * works", "deps": ["t-qhrbem"]}
{"t": "task", "id": "t-t5anul", "spec": "ralph-refactor.md", "name": "Extract tui/art.py Ralph ASCII art", "s": "p", "notes": "Extract Ralph Wiggum ASCII art in multiple styles. Art selection based on state/stage.", "accept": "from ralph.tui.art import get_art works; returns ASCII art string", "deps": ["t-t06dzv"]}
{"t": "task", "id": "t-uarbnz", "spec": "ralph-refactor.md", "name": "Extract tui/fallback.py ANSI dashboard", "s": "p", "notes": "Extract ANSI-based fallback dashboard for terminals without Textual. Same information as Textual dashboard, simpler rendering.", "accept": "from ralph.tui.fallback import FallbackDashboard works", "deps": ["t-t06dzv", "t-q46v22", "t-qqgd1z"]}
{"t": "task", "id": "t-ufasta", "spec": "ralph-refactor.md", "name": "Extract tui/dashboard.py Textual dashboard", "s": "p", "notes": "Extract Textual-based dashboard app with real-time status display and stage progress visualization.", "accept": "from ralph.tui.dashboard import Dashboard works; Dashboard is a Textual App subclass", "deps": ["t-t06dzv", "t-q46v22", "t-t5anul"]}
{"t": "task", "id": "t-ujn2xp", "spec": "ralph-refactor.md", "name": "Create tests/__init__.py and conftest.py", "s": "p", "notes": "Create ralph/tests/ package with __init__.py and conftest.py containing common pytest fixtures for mocking git, opencode, filesystem.", "accept": "pytest ralph/tests/ discovers tests; fixtures available", "deps": ["t-qhrbem"]}
{"t": "task", "id": "t-unrm7j", "spec": "ralph-refactor.md", "name": "Create tests/unit/__init__.py", "s": "p", "notes": "Create ralph/tests/unit/ package with __init__.py.", "accept": "Directory exists with __init__.py", "deps": ["t-ujn2xp"]}
{"t": "task", "id": "t-urqm7k", "spec": "ralph-refactor.md", "name": "Write test_utils.py unit tests", "s": "p", "notes": "Write unit tests for ralph/utils.py: test id_generate uniqueness, test colored output, test ANSI formatting.", "accept": "pytest ralph/tests/unit/test_utils.py passes", "deps": ["t-unrm7j", "t-qqgd1z"]}
{"t": "task", "id": "t-uwbssk", "spec": "ralph-refactor.md", "name": "Write test_models.py unit tests", "s": "p", "notes": "Write unit tests for ralph/models.py: test Task/Issue/Tombstone creation, status transitions, to_dict/from_dict serialization.", "accept": "pytest ralph/tests/unit/test_models.py passes", "deps": ["t-unrm7j", "t-qvm02k"]}
{"t": "task", "id": "t-u0ep83", "spec": "ralph-refactor.md", "name": "Write test_config.py unit tests", "s": "p", "notes": "Write unit tests for ralph/config.py: test TOML loading, profile resolution, defaults, missing file handling.", "accept": "pytest ralph/tests/unit/test_config.py passes", "deps": ["t-unrm7j", "t-qzr2sy"]}
{"t": "task", "id": "t-u54rxw", "spec": "ralph-refactor.md", "name": "Write test_state.py unit tests", "s": "p", "notes": "Write unit tests for ralph/state.py: test JSONL parsing, load_state/save_state roundtrip, merge logic, validation.", "accept": "pytest ralph/tests/unit/test_state.py passes", "deps": ["t-unrm7j", "t-q46v22"]}
{"t": "task", "id": "t-u919hd", "spec": "ralph-refactor.md", "name": "Write test_context.py unit tests", "s": "p", "notes": "Write unit tests for ralph/context.py: test Metrics dataclass, threshold constants, pressure calculations.", "accept": "pytest ralph/tests/unit/test_context.py passes", "deps": ["t-unrm7j", "t-reayd6"]}
{"t": "task", "id": "t-vd201a", "spec": "ralph-refactor.md", "name": "Write test_analysis.py unit tests", "s": "p", "notes": "Write unit tests for ralph/analysis.py: test rejection pattern detection, issue suggestion from patterns.", "accept": "pytest ralph/tests/unit/test_analysis.py passes", "deps": ["t-unrm7j", "t-rnvviw"]}
{"t": "task", "id": "t-wa24zq", "spec": "ralph-refactor.md", "name": "Write test_prompts.py unit tests", "s": "p", "notes": "Write unit tests for ralph/prompts.py: test load_prompt, build_prompt_with_rules, merge_prompts.", "accept": "pytest ralph/tests/unit/test_prompts.py passes", "deps": ["t-unrm7j", "t-rj3lls"]}
{"t": "task", "id": "t-we3t5b", "spec": "ralph-refactor.md", "name": "Write test_git.py unit tests", "s": "p", "notes": "Write unit tests for ralph/git.py: test git command mocking, sync logic, push retry, status checks.", "accept": "pytest ralph/tests/unit/test_git.py passes with mocked subprocess", "deps": ["t-unrm7j", "t-q9a9n4"]}
{"t": "task", "id": "t-wj0g06", "spec": "ralph-refactor.md", "name": "Create tests/e2e/__init__.py", "s": "p", "notes": "Create ralph/tests/e2e/ package with __init__.py.", "accept": "Directory exists with __init__.py", "deps": ["t-ujn2xp"]}
{"t": "task", "id": "t-wnfcnr", "spec": "ralph-refactor.md", "name": "Write test_cli.py e2e tests", "s": "p", "notes": "Write e2e tests for CLI: test command parsing, help output, version output.", "accept": "pytest ralph/tests/e2e/test_cli.py passes", "deps": ["t-wj0g06", "t-txl244"]}
{"t": "task", "id": "t-wrby79", "spec": "ralph-refactor.md", "name": "Write test_init.py e2e tests", "s": "p", "notes": "Write e2e tests for ralph init: test initialization in temp repo, verify file creation.", "accept": "pytest ralph/tests/e2e/test_init.py passes", "deps": ["t-wj0g06", "t-spqfwr"]}
{"t": "task", "id": "t-wwneuh", "spec": "ralph-refactor.md", "name": "Write test_task_workflow.py e2e tests", "s": "p", "notes": "Write e2e tests for task workflow: add task, mark done, accept/reject.", "accept": "pytest ralph/tests/e2e/test_task_workflow.py passes", "deps": ["t-wj0g06", "t-s5st5x"]}
{"t": "task", "id": "t-w18613", "spec": "ralph-refactor.md", "name": "Write test_construct_flow.py e2e tests", "s": "p", "notes": "Write e2e tests for construct flow: mock opencode, verify stage transitions. Must mock opencode to avoid token usage.", "accept": "pytest ralph/tests/e2e/test_construct_flow.py passes; no API tokens consumed", "deps": ["t-wj0g06", "t-tjfypt"]}
{"t": "task", "id": "t-w5881x", "spec": "ralph-refactor.md", "name": "Update bootstrap.sh PYTHONPATH", "s": "p", "notes": "Add export PYTHONPATH=\"$REPO_ROOT:$PYTHONPATH\" to shell configs in bootstrap.sh. Ensure ralph package is importable.", "accept": "After running bootstrap.sh, python -c \"import ralph\" works", "deps": ["t-qhrbem"]}
{"t": "task", "id": "t-xbbnra", "spec": "ralph-refactor.md", "name": "Replace powerplant/ralph with bash wrapper", "s": "p", "notes": "Replace the monolithic powerplant/ralph script with a bash wrapper: #!/usr/bin/env bash; exec python3 -m ralph \"$@\"", "accept": "powerplant/ralph is a bash script; ralph --help invokes python -m ralph successfully", "deps": ["t-txl244", "t-w5881x"]}
{"t": "task", "id": "t-xgd4ch", "spec": "ralph-refactor.md", "name": "Create ralph/AGENTS.md development rules", "s": "p", "notes": "Create AGENTS.md with Ralph development rules: workflow, testing requirements, code style, complexity limits, self-improvement loop.", "accept": "File exists at ralph/AGENTS.md with content per spec", "deps": ["t-qhrbem"]}
{"t": "task", "id": "t-xkwiod", "spec": "ralph-refactor.md", "name": "Create ralph/py.typed marker", "s": "p", "notes": "Create PEP 561 marker file for type hint support. Empty file.", "accept": "File exists at ralph/py.typed", "deps": ["t-qhrbem"]}
{"t": "task", "id": "t-xpkvve", "spec": "ralph-refactor.md", "name": "Add type hints to all public functions", "s": "p", "notes": "Ensure all public functions in ralph package have type hints. Check models.py, state.py, config.py, commands/*.py, stages/*.py, etc.", "accept": "mypy ralph/ --ignore-missing-imports passes or shows only minor issues", "deps": ["t-txl244", "t-r1rd5a", "t-ufasta", "t-uarbnz"]}
{"t": "task", "id": "t-xtllc0", "spec": "ralph-refactor.md", "name": "Add docstrings to all public functions", "s": "p", "notes": "Ensure all public functions in ralph package have docstrings explaining their purpose, parameters, and return values.", "accept": "pydocstyle ralph/ or manual review confirms docstrings present", "deps": ["t-txl244", "t-r1rd5a", "t-ufasta", "t-uarbnz"]}
{"t": "task", "id": "t-xzxjoc", "spec": "ralph-refactor.md", "name": "Verify complexity limits with radon", "s": "p", "notes": "Run radon cc ralph/ --min C and ensure no function exceeds complexity 10. Max 50 lines per function, 500 lines per module.", "accept": "radon cc ralph/ --min C returns no results; no function > 50 lines; no module > 500 lines", "deps": ["t-txl244", "t-r1rd5a", "t-ufasta", "t-uarbnz"]}
{"t": "task", "id": "t-x5jkmu", "spec": "ralph-refactor.md", "name": "Verify command parity with original ralph", "s": "p", "notes": "Test all commands work identically: init, status, config, watch, plan, construct, query, task add/done/accept/reject/delete/prioritize, issue add/done/done-all/done-ids, stream.", "accept": "All commands produce same behavior as original monolithic script", "deps": ["t-xbbnra"]}
{"t": "task", "id": "t-yatbj0", "spec": "ralph-refactor.md", "name": "Verify backwards compatibility", "s": "p", "notes": "Ensure existing ralph/specs/*.md, ralph/plan.jsonl, ralph/PROMPT_*.md, and ~/.config/ralph/config.toml files work unchanged with new code.", "accept": "Existing files readable and functional; no data migration needed", "deps": ["t-xbbnra"]}
{"t": "task", "id": "t-yg6dxf", "spec": "ralph-refactor.md", "name": "Verify all unit tests pass in < 30s", "s": "p", "notes": "Run pytest ralph/tests/unit/ and ensure all tests pass within 30 seconds total.", "accept": "pytest ralph/tests/unit/ passes; total time < 30 seconds", "deps": ["t-urqm7k", "t-uwbssk", "t-u0ep83", "t-u54rxw", "t-u919hd", "t-vd201a", "t-wa24zq", "t-we3t5b"]}
{"t": "task", "id": "t-yl9p3v", "spec": "ralph-refactor.md", "name": "Verify all e2e tests pass in < 60s", "s": "p", "notes": "Run pytest ralph/tests/e2e/ and ensure all tests pass within 60 seconds total, with opencode mocked.", "accept": "pytest ralph/tests/e2e/ passes; total time < 60 seconds; no API tokens consumed", "deps": ["t-wnfcnr", "t-wrby79", "t-wwneuh", "t-w18613"]}
{"t": "task", "id": "t-z88cn8", "spec": "ralph-refactor.md", "name": "Verify shell completions work after refactor", "s": "p", "accept": "Shell completions for ralph commands work after running bootstrap.sh", "deps": ["t-xbbnra"]}
{"t": "task", "id": "t-0a7xbs", "spec": "ralph-refactor.md", "name": "Verify ralph can construct itself", "s": "p", "accept": "ralph construct ralph/specs/ralph-refactor.md can be run (verifies self-hosting capability)", "deps": ["t-xbbnra"]}
{"t": "task", "id": "t-9z3glc", "spec": "ralph-refactor.md", "name": "Create ralph/__main__.py entry point", "s": "p", "notes": "Create ralph/__main__.py that imports from cli and calls main(). This enables python -m ralph to work. Standard pattern: from ralph.cli import main; if __name__ == \"__main__\": main()", "accept": "python -m ralph --help works after cli.py exists", "deps": ["t-txl244"]}
{"t": "task", "id": "t-pgp45k", "spec": "ralph-refactor.md", "name": "Extract utils.py utilities", "s": "p", "notes": "Extract utility functions: id_generate for unique IDs, ANSI color helpers (red, green, yellow, blue, bold, dim), and misc utilities from powerplant/ralph.", "accept": "from ralph.utils import id_generate, red, green, yellow, bold works", "deps": ["t-qhrbem"]}
{"t": "issue", "id": "i-jzfwf9", "spec": "ralph-refactor.md", "desc": "REPEATED REJECTION (4x): Task 't-q46v22' (t-q46v22) keeps failing with: Acceptance criteria mentions 'test_state.py passes' but test_state.py is created by separate task t-; ; Acceptance criteria requires test_state.py to pass, but test_state.py is a separate task (t-u54rxw).. Investigate root cause - may need prerequisite task or spec clarification.", "priority": "high"}
{"t": "reject", "id": "t-q46v22", "done_at": "bf319ad", "reason": "Acceptance criteria mentions 'test_state.py passes' but test_state.py is created by separate task t-u54rxw. The core functionality (RalphState, load_state, save_state imports) works correctly. Should update acceptance criteria to remove test requirement, or verify only import works."}
{"t": "reject", "id": "t-q46v22", "done_at": "d9cf9e5", "reason": "Acceptance criteria requires test_state.py to pass, but test_state.py is a separate task (t-u54rxw). Import portion works: from ralph.state import RalphState, load_state, save_state succeeds. Criteria should be updated to only include import requirement, or test should be written."}
{"t": "reject", "id": "t-q9a9n4", "done_at": "b93cd64", "reason": "Acceptance criteria requires test_git.py to pass, but test_git.py is a separate task (t-we3t5b). Import portion works: from ralph.git import sync_with_remote, push_with_retry, has_uncommitted_plan succeeds. Criteria should be updated to only include import requirement, or test should be written."}
{"t": "reject", "id": "t-q46v22", "done_at": "61f86fe", "reason": "Acceptance criteria requires test_state.py to pass, but test_state.py is created by separate task t-u54rxw. The module extraction is complete (imports work), but acceptance criteria is unfulfillable until test task is done. Suggest: remove 'test_state.py passes' from this task's acceptance criteria since tests are a separate task."}
{"t": "accept", "id": "t-q46v22", "done_at": "6a8b498", "reason": ""}
{"t": "accept", "id": "t-q9a9n4", "done_at": "6a8b498", "reason": ""}
{"t": "accept", "id": "t-pc7rep", "done_at": "6a8b498", "reason": ""}
{"t": "accept", "id": "t-qhrbem", "done_at": "6a8b498", "reason": ""}
{"t": "accept", "id": "t-qqgd1z", "done_at": "6a8b498", "reason": ""}
{"t": "accept", "id": "t-qvm02k", "done_at": "6a8b498", "reason": ""}
{"t": "accept", "id": "t-qzr2sy", "done_at": "6a8b498", "reason": ""}
{"t": "accept", "id": "t-reayd6", "done_at": "9824c02", "reason": ""}
{"t": "accept", "id": "t-rj3lls", "done_at": "b8c8506", "reason": ""}
{"t": "accept", "id": "t-rnvviw", "done_at": "24384c2", "reason": ""}
{"t": "accept", "id": "t-rs0vlm", "done_at": "117e8b2", "reason": ""}
{"t": "accept", "id": "t-rw8z73", "done_at": "408a19c", "reason": ""}
{"t": "accept", "id": "t-r1rd5a", "done_at": "2193ff5", "reason": ""}
{"t": "accept", "id": "t-r5dzxs", "done_at": "3072a8e", "reason": ""}
{"t": "accept", "id": "t-r9yj8k", "done_at": "62de226", "reason": ""}
{"t": "accept", "id": "t-sczvjn", "done_at": "d7f44a4", "reason": ""}
{"t": "accept", "id": "t-sgsuyp", "done_at": "529c22f", "reason": ""}
{"t": "accept", "id": "t-skfdoh", "done_at": "6ad4a11", "reason": ""}
{"t": "accept", "id": "t-gzknz9", "done_at": "c8f5458", "reason": ""}
{"t": "accept", "id": "t-g4dxjs", "done_at": "3ee09c9", "reason": ""}
