#!/bin/bash

# Exit if already running
pidof -x -o $$ "$(basename "$0")" >/dev/null && exit 0

WALL_DIR="$HOME/Pictures/Waifu"
INTERVAL=300  # seconds
TRANSITION="random"

# Start swww daemon if not running, wait for it to be ready
if ! pgrep -x swww-daemon >/dev/null; then
    swww-daemon 2>/dev/null &
    sleep 1  # Wait for daemon to initialize
fi

# Pick ONE image and set it
IMG="$(find "$WALL_DIR" -type f \( -name '*.jpg' -o -name '*.png' -o -name '*.webp' \) | shuf -n 1)"
swww img "$IMG" --resize fit --transition-type "$TRANSITION" 2>/dev/null

while true; do
    sleep $INTERVAL
    IMG="$(find "$WALL_DIR" -type f \( -name '*.jpg' -o -name '*.png' -o -name '*.webp' \) | shuf -n 1)"
    swww img "$IMG" --resize fit --transition-type "$TRANSITION" 2>/dev/null
done
